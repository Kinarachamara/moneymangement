<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>පෞද්ගලන</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background:#f2f2f2; padding:20px; max-width:900px; margin:auto; }
h1 { text-align:center; color:#4a148c; }
button { margin:10px; padding:10px 20px; font-size:1rem; cursor:pointer; border:none; border-radius:8px; color:white; background:linear-gradient(90deg,#7b1fa2,#4a148c);}
table { width:100%; border-collapse:collapse; margin-top:20px; background:white; border-radius:8px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
th,td { padding:8px; border:1px solid #ccc; text-align:left;}
th { background:#e1bee7; }
.income { color:green; font-weight:bold;}
.expense { color:red; font-weight:bold;}
.balance { font-size:1.2rem; font-weight:bold; text-align:center; margin-top:10px; color:goldenrod;}
#formModal { display:none; position:fixed; z-index:1000; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
#formModal div { background:white; padding:20px; border-radius:10px; max-width:400px; width:90%; }
</style>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

<h1>පෞද්ගලික මුදල් පාලන</h1>

<button onclick="openForm()">Add Transaction</button>
<button onclick="downloadPDF()">Download PDF</button>

<div id="formModal">
  <div>
    <span style="float:right; cursor:pointer;" onclick="closeForm()">×</span>
    <h3>New Transaction</h3>
    <label>Date: <input type="date" id="txDate"></label><br><br>
    <label>Description: <input type="text" id="txDesc"></label><br><br>
    <label>Type: 
      <select id="txType">
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
      </select>
    </label><br><br>
    <label>Category: 
      <select id="txCategory"></select>
    </label><br><br>
    <label>Amount: <input type="number" id="txAmount"></label><br><br>
    <button onclick="addTransaction()">Save</button>
  </div>
</div>

<table id="txTable">
  <thead>
    <tr><th>Date</th><th>Description</th><th>Type</th><th>Category</th><th>Amount</th></tr>
  </thead>
  <tbody></tbody>
</table>

<div id="balance" class="balance"></div>

<script>
let data = [];
const categories = {
  Income: ["Salary","Sale","Other"],
  Expense: ["Bills","Shopping","Food","Misc"]
};

function openForm() {
  document.getElementById("formModal").style.display="flex";
  const type = document.getElementById("txType").value;
  const categorySelect = document.getElementById("txCategory");
  categorySelect.innerHTML = "";
  categories[type].forEach(c=> { let opt=document.createElement("option"); opt.value=c; opt.textContent=c; categorySelect.appendChild(opt);});
}

function closeForm(){document.getElementById("formModal").style.display="none";}

document.getElementById("txType").addEventListener("change",openForm);

function addTransaction(){
  const date = document.getElementById("txDate").value;
  const desc = document.getElementById("txDesc").value;
  const type = document.getElementById("txType").value;
  const category = document.getElementById("txCategory").value;
  const amount = parseFloat(document.getElementById("txAmount").value);

  if(!date || !desc || !amount) return alert("Fill all fields!");

  data.push({date,desc,type,category,amount});
  renderTable();
  closeForm();
}

function renderTable(){
  const tbody = document.querySelector("#txTable tbody");
  tbody.innerHTML="";
  let balance=0;
  data.sort((a,b)=> new Date(a.date)-new Date(b.date)).forEach(tx=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${tx.date}</td><td>${tx.desc}</td><td class="${tx.type.toLowerCase()}">${tx.type}</td><td>${tx.category}</td><td>${tx.amount.toFixed(2)}</td>`;
    tbody.appendChild(tr);
    balance += tx.type==="Income"? tx.amount: -tx.amount;
  });
  document.getElementById("balance").textContent="Total Balance: Rs. "+balance.toFixed(2);
}

function downloadPDF(){
  if(data.length===0) return alert("No transactions!");
  const doc = new jsPDF();
  doc.setFontSize(16).text("Personal Finance Report",14,20);
  doc.setFontSize(12);
  doc.autoTable({
    startY:30,
    head:[["Date","Description","Type","Category","Amount"]],
    body: data.map(tx=>[tx.date,tx.desc,tx.type,tx.category,tx.amount.toFixed(2)]),
    styles:{fontSize:10}
  });
  const total = data.reduce((sum,tx)=> sum + (tx.type==="Income"?tx.amount:-tx.amount),0);
  doc.text("Total Balance: Rs. "+total.toFixed(2),14, doc.lastAutoTable.finalY +10);
  doc.save("PersonalFinance.pdf");
}
</script>

</body>
</html>
